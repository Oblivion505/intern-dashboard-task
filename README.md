# Intern Take-Home Challenge

## Overview

This is a starter monorepo for a device monitoring dashboard. Your task is to implement a POST endpoint in the API and ensure the frontend works correctly with it.

## Tech Stack

- **Bun** - Package manager and runtime
- **Express** - API server (running on Bun)
- **React + Tailwind CSS** - Web frontend (Vite + React)
- **TypeScript** - Used throughout
- **Zod** - Request validation
- **In-memory storage** - No database required for this challenge

## Getting Started

### Prerequisites

- [Bun](https://bun.sh) installed on your system

> **_NOTE:_** Please disable all code completion extensions on your IDE before continuing with this assessment

### Installation

```bash
# Install all dependencies
bun install
```

### Running the Applications

```bash
# Run both API and web concurrently
bun dev

# Or run individually:
bun dev:api  # API server on http://localhost:3001
bun dev:web  # Web app on http://localhost:5173
```

The API server will be available at `http://localhost:3001` and the web application at `http://localhost:5173`.

## Project Structure

```
.
├── apps/
│   ├── api/          # Express API server
│   └── web/          # React frontend
├── packages/
│   └── shared/       # Shared TypeScript types
└── package.json      # Root workspace configuration
```

## Assignment Brief

### Current State

The API currently has these endpoints implemented:

- `GET /devices` - Returns all devices
- `GET /devices/:id/readings?limit=20` - Returns readings for a device (newest first, respects limit)
- `GET /health` - Health check endpoint

The `POST /devices/:id/readings` endpoint currently returns `501 Not Implemented` with the message:
```json
{ "error": { "message": "Not implemented - candidate task" } }
```

The web app has a form to create readings, but it will show an error until you implement the POST endpoint.

### Required Tasks

#### 1. Implement POST /devices/:id/readings in apps/api

Requirements:
- Validate that the device exists (return 404 if not found)
- Validate request body using Zod:
  - `powerUsageKw`: number >= 0 (required)
  - `timestamp`: string (optional)
- If `timestamp` is missing: server should set it to `new Date().toISOString()`
- If `timestamp` is provided: must parse as valid date/ISO string
- Add new reading to in-memory store with a generated `id` (string)
- Return `201` with the saved reading object
- Return `400` or `404` with consistent error shape: `{ error: { message: string, details?: any } }`

#### 2. Update the Frontend

Ensure that submitting the form works correctly:
- On successful POST: refresh the readings list and show a success message
- On error: display the API error message
- The form should now work without errors

#### 3. Add Production Considerations

Add a short README section titled "If this were production..." detailing what you would do differently for the following concerns:
- Scale/Performance
- Data Integrity
- Security
- API Design/Versioning
- Realtime
- Observability

## Data Models

### Device
```typescript
{
  id: number;
  name: string;
  status: "online" | "offline" | "warning";
  site: string;
}
```

### Reading
```typescript
{
  id: string;              // Generated by server
  deviceId: number;
  timestamp: string;       // ISO string
  powerUsageKw: number;
}
```

## Development Notes

- CORS is enabled for `http://localhost:5173` to allow the web app to call the API
- The API uses in-memory storage - data resets on server restart
- Device status is computed based on the latest reading timestamp (30 min = warning, 2 hours = offline)
- All error responses follow a consistent format: `{ error: { message: string, details?: any } }`
- Seed data includes 5 devices with ~5 readings each (timestamps spread across last 6 hours)

## Submission Expectations

Please submit:

1. Your implementation of the POST endpoint
2. Updated frontend (if any changes needed)
3. Completed "If this were production..." section in README

The goal is to test endpoint creation + integration, not UI design.
